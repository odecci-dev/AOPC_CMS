@using Microsoft.AspNetCore.Http;
@inject IHttpContextAccessor Accessor;
@{
    ViewData["Title"] = "Corporate User Maintenance";
     Layout = "~/Views/Shared/_LayoutCorporate.cshtml";
    string message = "";
    if (ViewData["Message"] != null)
    {
        message = ViewData["Message"].ToString();
    }

}
<style>
    .cust-pagination {
        display: flex;
        gap: 10px;
        justify-content: space-between;
        margin: 0px 50px 0px 40px;
    }

    .active-page {
        color: black !important;
    }

    #counter .tbl-pagenumber {
        color: #c89328;
        cursor: pointer;
        padding: 5px;
    }

    #prev {
        color: #c89328;
        cursor: pointer;
    }

    #next {
        color: #c89328;
        cursor: pointer;
    }
</style>

<div class="register-main-container_2">
         <ul class="nav nav-tabs justify-content-lg-start">
            <li class="nav-items">
                <a class="nav-link" href="#User" data-toggle="tab" aria-expanded="true"><i class="fas fa-users"></i>User Registration</a>
            </li>
            <li class="nav-items">
                <a class="nav-link" href="#Admin" data-toggle="tab" aria-expanded="false"><i class="fas fa-users"></i>Add new Position</a>
            </li>

        </ul>
   

    <div class="tab-content">
            <div class="tab-pane active " id="User">
                <br>
                <div class="card-body ">
                    <div class="row">

                        <div class="col-lg-10">
                        <div style="width: 100%; display: flex; justify-content: flex-end; margin: 10px 0; padding-right:20px">
                            <div style="display:flex;width:100%">
                                <div class="info" style="width:100%;    margin: 0px 0px 0px 25px;">
                                    <p class="name" id="ucount">User Count</p>
                                
                              
                            </div>
                                <div style="display:flex;" class="info">
                                <p class="name" style="    margin: 5px 10px 0px 10px;" for="srchbox">Search</p>

                                    <input type="text" value="" id="srchbox" style="height: 25px;
                                    width:500px;
                                    outline: none;
                                    border: 1px solid #e7e6e6;
                                    box-shadow: inset 1px 2px 1px 1px rgba(116, 113, 113, 0.5);
                                    border-radius: 5px;" />
                                
                                    <select id="position" class="mod-input" style="width:50%">
                                        <option required value="" disabled selected>Select your Position</option>
                                    </select>
                            </div>
                            </div>
                        </div>
                            <div class="row ">
                                <div id="register-table_wrapper" class="dataTables_wrapper no-footer" style="width:100%">
                                    <table id="corpuserregister-table" class="myTableMedium">
                                         <thead>
                                        <th>
                                           <button class="register"  style ="margin-bottom: 5px;font-size: 13px;    padding: 5px 15px 5px 5px;height: 25px;font-size: clamp(0.5rem, 2vw, 0.7rem);" title="Add New" id="add-newuser"><i class="fas fa-user-plus"></i>Add New</button>
                                        </th>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Gender</th>
                                        <th>Company Name</th>
                                        <th>Position</th>
                                        <th>Status</th>
                                        <th>Date Created</th>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                    </table>
                                <div class="cust-pagination">
                                    <span id="prev">Prev</span>
                                    <div id="counter"></div>
                                    <span id="next">Next</span>
                                </div>
                               </div>
                            </div>
                        </div>

                        <div class="col-lg-2">
                            <div class="row">
                                <div class="col-lg-12 col-md-6">
                                    <hr>
                                    <div>
                                    @using (Html.BeginForm("CorpAdminIndex", "Corporate", FormMethod.Post, new { enctype = "multipart/form-data" }))
                                    {
                                                                <label class="name">Import Excel File:</label>
                                                                <input id="upload-excel" type="file" size="1" name="file" accept="excel/*" class="form-control-sm mb-1">
                                                                <button type="submit" class="btn btn-success btn-block mb-1" id="btnimport" data-toggle="tooltip" title="Import Excel"><i class="fas fa-upload"></i> Upload</button>
                                    }
                                    </div>
                                </div>
                                <div class="col-lg-12 col-md-6">
                                    <button type="button" class="btn btn-info btn-block" id="btn-download-user" data-toggle="tooltip" title="Download Header"><i class="fas fa-download"></i> Download Template</button>
                                </div>
                                <div style="font-size:12px !important;margin-left:10px">
                                    @if (message != "")
                                    {

                                        @if (message.Contains("Error") || message.Contains("Duplicate Entry."))
                                        {
                                            <div class="alert alert-warning" >
                                            <div style="    width: 100%;
                                                display: flex;
                                                flex-direction: row;
                                                margin: 0px 0px 0px 10px;">
                                                <span style="font-weight: bold;width:200px;display: inline;">Warning!</span>
                                            </div>

                                            <div id="blink">
                                           
                                             <a href="#" class="close" data-dismiss="alert" aria-label="close" >&times;</a>
                                                <strong >  <i class="fas fa-exclamation-triangle"></i> @message.Replace(" Error: ", "")</strong>

                                            </div>
                                            </div>

                                          <script>
                                                  window.addEventListener("load", function () {
                                                  var b = document.getElementById('blink');
                                                  setInterval(function () {
                                                    b.style.display = (b.style.display == 'none' ? '' : 'none');
                                                }, 500);
                                            }, false);
                                          </script>

                                        }
                                        else
                                        {
                                            <div class="alert alert-success" style="height: 100%;width: 100%;">
                                            <div style="    width: 100%;
                                                display: flex;
                                                flex-direction: row;
                                                margin: 0px 0px 0px 10px;">
                                                <span style="font-weight: bold;width:200px;display: inline;">Success!</span>
                                            </div>
                                            <div id="blink">

                                                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                                <strong>  <i class="fas fa-check-circle"></i> @message.Replace(" Error: ", "")</strong>

                                            </div>
                                        </div>
                                         
                                            <script>
                                                  window.addEventListener("load", function () {
                                                  var b = document.getElementById('blink');
                                                  setInterval(function () {
                                                  b.style.display = (b.style.display == 'none' ? '' : 'none');}, 500); }, false);
                                          </script>
                                        }
                                    }
                              </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        <div class="tab-pane" id="Admin">
         
             
                <div class="card-body ">
                    <div class="row">

                        <div class="col-lg-12">

                            <div class="row ">
                                <div id="register-table_wrapper" class="dataTables_wrapper no-footer" style="width:100%">
                                    <table id="pos-table" class="myTableMedium">
                                        <thead>
                                        <th>
                                            <button class="register" style="margin-bottom: 5px;font-size: 13px;      width: 100px;  padding: 5px 15px 5px 5px;height: 25px;font-size: clamp(0.5rem, 2vw, 0.7rem);" title="Add New Position" id="add-position"><i class="fas fa-user-plus"></i>Add New</button>
                                        </th>
                                        <th>Description</th>
                                        <th>Date Created</th>
                                        </thead>
                                        <tbody style="height: 150px;">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
        </div>
    </div>
</div>
        
        <div class="modal fade" id="positionmodal" tabindex="-1" role="dialog" aria-labelledby="modal-title"
             aria-hidden="true" style="display: none;" data-keyboard="false" data-backdrop="static">

            <div class="modal-dialog modal-error-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="modal-name">Position Details Form</h4>
                        <button type="button" id="h-close" class="close" data-dismiss="modal" aria-hidden="false">x</button>
                    </div>
                    <div class="col-lg-12" style="margin:10px">

                        <form action="" class="mod-form" id="submitpos">

                            <div class="mod-form-row">
                                <div class="input-container-whole">
                                    <label for="employeeID">Position Name<span class="req">*</span></label>
                                    <input type="text" value="" id="posname" class="mod-input" required />
                                </div>

                            </div>
                            <div class="mod-form-row">
                                <div class="input-container-whole">
                                    <label for="email">Position Description</label>
                                    <input type="text" value="" id="desc" class="mod-input" />
                                </div>
                            </div>


                            <div class="actions" style="align-items: center;">
                                <div class="actionss">
                                    @* <button class="register" type="button" style ="margin-bottom: 5px;font-size: 13px;    padding: 5px 15px 5px 5px;height: 25px;font-size: clamp(0.5rem, 2vw, 0.7rem);" title="Add New" id="add Mechanics"><i class="fas fa-id-card"></i>Add Mechanics</button> *@
                                    @* <input type="button" value="Add Mechanics" id="btn-register"/> <i class="fas fa-cogs"></i> *@

                                </div>

                                <a data-dismiss="modal" aria-hidden="false" style="cursor:pointer" class="cancel"><u>Cancel</u></a>
                                <input type="submit" value="Submit" id="btn-save" />
                            </div>
                        </form>


                    </div>
                </div>
            </div>

        </div>


  <div class="modal fade" id="registermodal" tabindex="-1" role="dialog" aria-labelledby="modal-title"
        aria-hidden="true" style="display: none;" data-keyboard="false" data-backdrop="static" >

        <div class="modal-dialog modal-error-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="modal-name">User Registration Form </h4>
                    <button type="button" id="h-close" class="close" data-dismiss="modal" aria-hidden="false">x</button>
                </div>
                <div class="col-lg-12" style="margin:10px">

                    <form action="" class="mod-form">
          <div class="mod-form-row">
            <div class="input-container-whole">

              <div class="upload-image-preview" id="upload-image-preview" style="background-color: gainsboro;">
                <img
                  width="100%"
                  src="https://www.alfardanoysterprivilegeclub.com/assets/img/defaultavatar.png"
                  alt=""
                />
              </div>
            </div>
            <div class="input-container-whole upload" >
              <label for="img">Upload Image</label>
              <input
                type="file"
                value=""
                id="img"
                class="mod-input img-choose"
                name="uploadimg" accept="image/*"
              />
            </div>
          </div>
          <div class="mod-form-row">
            <div class="input-container-whole">
              <label for="employeeID">Employee ID</label>
              <input type="text" value="" id="empid" class="mod-input" required />
            </div>
            <div class="input-container-whole">
              <label for="email">Email</label>
              <input type="text" value="" id="email" class="mod-input" required/>
            </div>
          </div>
          <div class="mod-form-row">
            <div class="input-container-whole">
              <label for="fname">First Name</label>
              <input type="text" value="" id="fname" class="mod-input" required/>
            </div>
            <div class="input-container-whole">
              <label for="lname">Last Name</label>
              <input type="text" value="" id="lname" class="mod-input" required/>
            </div>
          </div>
          <div class="mod-form-row">
            <div class="input-container-whole">
              <label for="username"> Username</label>
              <input type="text" value="" id="user"  class="mod-input" required/>
            </div>
             <div class="input-container-whole">
              <label for="position"> Positon</label>
               <select id="corpadminuser-position" class="mod-input">
                  <option required value="" disabled selected>Select your option</option>
               </select>
            </div>
          </div>
          <div class="mod-form-row">
            <div class="input-container-whole">
              <label for="vipStatus">VIP Status</label>
              <select id="vip-option"  class="mod-input" required>
                        <option value="" disabled selected>Select your option</option>
                        <option value="1">Yes</option>
                        <option value="0">No</option>            
              </select>
            </div>
            <div class="input-container-whole">
              <label for="gender">Gender</label>
               <select id="gender" class="mod-input" required>
                  <option value="" disabled selected>Select your option</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
            </div>
          </div>
          <div class="mod-form-row">
            <div class="input-container-whole" required>
              <label for="corporateName">Corporate Name</label>
                <select id="user-corporate-option" class="mod-input" disabled >
                     <option value=" @Accessor.HttpContext.Session.GetString("CorporateID") " disabled selected>@Accessor.HttpContext.Session.GetString("CorporateName")</option>
                </select>
            </div>
          <div class="input-container-whole" required>
              <label for="membershipTier">Membership Tier</label>
             <select id="mem-option" class="mod-input" disabled>
                 <option value=""  selected>@Accessor.HttpContext.Session.GetString("MembershipName")</option>
             </select>
          </div>
          </div>
          <div class="corp_actions" style="display: flex; */ /* width: 100%; */ display: flex; /* width: 100%; */ justify-content: flex-end; align-items: center; gap: 20px; flex-direction: row; ">
            <a  data-dismiss="modal" aria-hidden="false" style="cursor:pointer" class="cancel">Cancel</a>
            <input type="button" value="Submit" id="btn-register"/>
          </div>
        </form>


                </div>
            </div>
        </div>

  </div>
    
@section Scripts{
<script>
        var i_id = "";
        var img_edit="";
        var prev = 0;
        var next = 0;
        var spanval = "";
        var filtername = "";
        var currpage = "";
        var posId = "";
    $(document).ready(function () {
            $('#srchbox').keypress(function (event) {
                // Check if the key pressed is Enter (key code 13)
                if (event.which === 13) {
                    spanval = "0";
                    // Prevent the default action of the Enter key (e.g., form submission)
                    event.preventDefault();

                }
                else { 
                }
            });
            if (spanval =="" && posId== "" && filtername == "") {
                var data = {};
                data.FilterName = filtername;
                data.page = spanval;
                data.posId = posId;
                data.CorpId = @Accessor.HttpContext.Session.GetString("CorporateID");

                $.ajax({
                    url: '/Corporate/GetDataCorporateUser',
                    data: {
                        data: data,
                    },
                    type: "POST",
                    datatype: "json",
                    success: function (data) {
                        // console.log(data[0].items);
                        $('#counter').empty();
                        for (var i = 0; i < data[0].totalPage; i++) {
                            var newSpan = $("<span>").attr("id", "spanId" + (i + 1)).text(i + 1).attr("class", "tbl-pagenumber");

                            $("#counter").append(newSpan);
                        }
                    }
                });
        }
        // $('#position').change(function () {
        //         var selectedValue = $(this).val();
        //         var selectedText = $(this).find('position:selected').text();
        //         posId = selectedValue;
               
        // });
            dbtable = $('#corpuserregister-table').DataTable({
                "columnDefs": [

                    { "width": "150px", "targets": 0 },
                    { "width": "150px", "targets": 1 },
                    { "width": "150px", "targets": 2 },
                    { "width": "200px", "targets": 3 },
                    { "width": "150px", "targets": 4 }
                    // { "width": "70px", "targets": 9 }
                ],
                "deferRender": true,
                "bPaginate": false,
                "bFilter": false,
                "stripeClasses": [],
                "ordering": false,
                "ordering": false,
                "info": false,
                "bInfo": false,
                "bAutoWidth": false,
                "bLengthChange": false,
                "paging": false,
                "aLengthMenu": [10],
                "searching": false
                , "oLanguage": { "sZeroRecords": "", "sEmptyTable": "" }

            });


      $("input[name=uploadimg]").change(function () {
        if (this.files && this.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
        var img = $('<img>').attr('src', e.target.result);
        img.attr('height', '120px');
        img.attr('width', '120px');
        $('.upload-image-preview').html(img);};
        reader.readAsDataURL(this.files[0]);
                        }
                    }); postable = $('#pos-table').DataTable({
                        "columnDefs": [

                            { "width": "80px", "targets": 0 },
                            { "width": "150px", "targets": 1 },
                            { "width": "70px", "targets": 2 }
                        ],
                        order: [[2, "desc"]],
                        "bPaginate": false,
                        "bFilter": false,
                        "stripeClasses": [],
                        "ordering": false,
                        "info": false,
                        "bInfo": false,
                        "bAutoWidth": false,
                        "bLengthChange": false,
                        "paging": true,
                        "aLengthMenu": [10],
                        "searching": true,
                        "oLanguage": {
                            "sZeroRecords": "", "sEmptyTable": "",

                        }
                    });
      paginationCorpUser(spanval, filtername, posId)
      CorpShowPositionList();
        ShowPositionName();
       UserAdminShowPositionName();
       });
        function ShowPositionName() {
            $.blockUI(reloadLoading);
            setTimeout(function () {
                $.ajax(
                    {
                        url: "/Register/GetPosition",
                    data: {
                    }, type: "GET", 
                    datatype: "json" }
                    ).done(function (data) {
                    // $("#position").empty();
                    // $("#position").append('<option value="0">-Select Option-</option>');
                    //     console.log(data);
                    $('#position').empty();
                    $("#position").append('<option value="0" >-Select Position-</option>');
                    for (var i = 0; i < data.length; i++) {
                        $("#position").append('<option value="' + data[i].id + '">' +
                            data[i].positionName + '</option>');
                    }
                    $.unblockUI();
                }).fail(function () {
                    alert("There was an Error When Loading Data...");
                });
            }, 100);
        }
        $('#counter').on('click', '.tbl-pagenumber', function () {
            spanval = $(this).text();
            $(".tbl-pagenumber").removeClass("active-page");
            $(this).addClass("active-page");
            paginationCorpUser(spanval, filtername, posId)

        });
        $('#next').click(function () {
            //
            next = parseInt(next);
            $(".tbl-pagenumber").removeClass("active-page");
            console.log(next);
            $("#spanId" + (next)).addClass("active-page");
            paginationCorpUser(next, filtername, posId)

        });
        $('#prev').click(function () {

            prev = parseInt(prev);
            $(".tbl-pagenumber").removeClass("active-page");
            // console.log(prev);
            $("#spanId" + (prev)).addClass("active-page");
            paginationCorpUser(prev, filtername, posId)

        });
   function CorpShowPositionList() {
    $.blockUI(reloadLoading);
            $.ajax({
                url: "/Register/GetPosition",
                data: {
                },
                type: "GET",
                datatype: "json"
            }).done(function (data) {
                //console.log(data);
                postable.clear().draw();
                for (var i = 0; i < data.length; i++) {

                    var tdbuttons = "<div>" + "<p>" + data[i].positionID + "</p>" + "<p>" + data[i].positionName + "</p>" +
                        '<div class="actions"><a class="tbl-edit" data-id="' + data[i].id + '" data-posname="' + data[i].positionName + '"  data-description="' + data[i].description + '"   >' + '<svg width="11" height="11" viewBox="0 0 11 11" fill="none"xmlns="http://www.w3.org/2000/svg">' + '<path d="M5.02558 1.92456H1.89457C1.65732 1.92456 1.42978 2.0164 1.26201 2.17986C1.09425 2.34333 1 2.56504 1 2.79621V8.89779C1 9.12896 1.09425 9.35067 1.26201 9.51414C1.42978 9.6776 1.65732 9.76944 1.89457 9.76944H8.15659C8.39385 9.76944 8.62139 9.6776 8.78915 9.51414C8.95692 9.35067 9.05117 9.12896 9.05117 8.89779V5.847"' + 'stroke="black"' + 'stroke-linecap="round"' + 'stroke-linejoin="round"/>' + '<path d="M8.38023 1.27079C8.55817 1.09741 8.79951 1 9.05116 1C9.30281 1 9.54415 1.09741 9.72209 1.27079C9.90003 1.44417 10 1.67933 10 1.92453C10 2.16973 9.90003 2.40488 9.72209 2.57827L5.47286 6.71862L3.68372 7.15445L4.131 5.41114L8.38023 1.27079Z"' + 'stroke="black"' + 'stroke-linecap="round"' + 'stroke-linejoin="round"/>' + "</svg>" + "<span >Edit</span>" + " </a>";
                    $("#pos-table").dataTable().fnAddData([
                        "<td>" + tdbuttons + "</td>",
                        "<td><p>" + data[i].description + "</p></td>",
                        "<td><p>" + data[i].dateCreated + "</p></td>"]);
                }
                        $.unblockUI();

                    }).fail(function () {
                        alert("There was an Error When Loading Data...");
                    });
    }
   $('#user-corporate-option').change(function () {
                        var data = {};
                        data.Id = $('#user-corporate-option').val();
                        @*   *@
                        
                        $.ajax({
                            url: '/Register/CorporateFilterMembership',
                            data: {
                                data: data,
                            },
                            type: "POST",
                            datatype: "json",
                            success: function (response) {
                            // console.log(response.stats);
                            $('#mem-option').val(response.stats);
                        }
                        });

                 });
function UserAdminShowPositionName() {

    $.ajax({
        url: '/Register/GetPosition',
        data: {

        },
        type: "GET",
        datatype: "json"
    }).done(function (data) {

        $('#corpadminuser-position').empty();
        $("#corpadminuser-position").append('<option value="0" >-Select Position-</option>');
        for (var i = 0; i < data.length; i++) {
            $("#corpadminuser-position").append('<option value="' + data[i].id + '">' +
                data[i].positionName + '</option>');
        }
    
    });

        } 
        $("#srchbox").keypress(function (event) {
            // Check if the key pressed is Enter (key code 13)
            if (event.which === 13) {
                // Prevent the default action of the Enter key (e.g., form submission)
                event.preventDefault();

                // Perform your desired action here
                var userInput = $(this).val(); // Get the input value
                spanval = "0";
                posId = $('#position').val();
                paginationCorpUser(spanval, userInput, posId);
                var data = {};
                data.FilterName = filtername;
                data.page = spanval;
                data.posId = posId;
                data.CorpId = @Accessor.HttpContext.Session.GetString("CorporateID");

                $.ajax({
                    url: '/Corporate/GetDataCorporateUser',
                    data: {
                        data: data,
                    },
                    type: "POST",
                    datatype: "json",
                    success: function (data) {
                        // console.log(data[0].items);
                        $('#counter').empty();
                        for (var i = 0; i < data[0].totalPage; i++) {
                            var newSpan = $("<span>").attr("id", "spanId" + (i + 1)).text(i + 1).attr("class", "tbl-pagenumber");

                            $("#counter").append(newSpan);
                        }
                    }
                });
                // Optionally, you can call a function or submit a form here
                // Example: submitForm();
            }
   

        });
        $('#position').change(function () {
            var selectedValue = $(this).val();
            var selectedText = $(this).find('position:selected').text();
            posId = selectedValue;
            spanval = "0";
            filtername = $("#srchbox").val();
            paginationCorpUser(spanval, filtername, posId);
            var data = {};
            data.FilterName = filtername;
            data.page = spanval;
            data.posId = posId;
            data.CorpId = @Accessor.HttpContext.Session.GetString("CorporateID");

            $.ajax({
                url: '/Corporate/GetDataCorporateUser',
                data: {
                    data: data,
                },
                type: "POST",
                datatype: "json",
                success: function (data) {
                    // console.log(data[0].items);
                    $('#counter').empty();
                    for (var i = 0; i < data[0].totalPage; i++) {
                        var newSpan = $("<span>").attr("id", "spanId" + (i + 1)).text(i + 1).attr("class", "tbl-pagenumber");

                        $("#counter").append(newSpan);
                    }
                }
            });

        });
        function paginationCorpUser(spanval, filtername, posId) {
            var data = {};
            data.FilterName = filtername;
            data.page = spanval;
            data.posId = posId;
            data.CorpId = @Accessor.HttpContext.Session.GetString("CorporateID");
            $.blockUI(reloadLoading);
            $.ajax({
                url: '/Corporate/GetDataCorporateUser',
                data: {
                    data: data,
                },
                type: "POST",
                datatype: "json"
            }).done(function (data) {
              
                // console.log(data);
                dbtable.clear().draw();
                prev = data[0].prevPage;
                next = data[0].nextPage;
                currpage = data[0].currentPage;
                // $("#ucount").text(data[0].TotalRecord);
                $('#ucount').text('Total Record of ' + data[0].totalRecord + ' Registered Users');
                if (prev == 0) {
                        $("#prev").attr("disabled", true);
                        $("#prev").css("color", "gray").css("pointer-event", "none");
                    }
                    else {
                        $("#prev").attr("enabled", true);
                        $("#prev").css("color", "#c89328");
                    }
                    if (next == 0) {
                         console.log(next);

                        $("#next").attr("disabled", true);
                        $("#next").css("color", "gray").css("pointer-event", "none");
                    }
                    else {
                    console.log(next);
                        $("#next").attr("enabled", true);
                        $("#next").css("color", "#c89328");
                    }
                // $('#counter').empty();
                // for (var i = 0; i < data[0].totalPage; i++) {
                //     var newSpan = $("<span>").attr("id", "spanId" + (i + 1)).text(i + 1).attr("class", "tbl-pagenumber");

                //     $("#counter").append(newSpan);
                // }
                for (var i = 0; i < data[0].items.length; i++) {

                    var img = data[0].items[i].filePath;
                    if (img == "") {
                        img = "https://www.alfardanoysterprivilegeclub.com/assets/img/defaultavatar.png";
                    }
                    else {
                        img = data[0].items[i].filePath;
                    }

                    $('#corpuserregister-table tbody').append([
                        '<tr>' +
                        '<td>' +
                        ' <div class="data-img">' +
                        '<img src=' + img + ' alt=' + data[0].items[i].fname + ' width="100%" />' +
                        '</div>' +
                        '<div>' +
                        '<p>' + data[0].items[i].employeeID + '</p>' +
                        '<p>' + data[0].items[i].fname + ' ' + data[0].items[i].lname + '</p>' +
                        '<div class="actions"><a class="tbl-edit" data-id="' + data[0].items[i].id + '" data-username="' + data[0].items[i].username + '" data-employeeid="' + data[0].items[i].employeeID +
                        '" data-fname="' + data[0].items[i].fname + '" data-lname="' + data[0].items[i].lname + '" data-email="' + data[0].items[i].email + '" data-pos="' + data[0].items[i].positionID + '"  data-gender="' + data[0].items[i].gender +
                        '" data-utype="' + data[0].items[i].userType + '" data-vipstats="' + data[0].items[i].isVIP + '" data-usercorpid="' + data[0].items[i].corporateID + '"  data-displayimg="' + data[0].items[i].filePath + '">' +
                        '<svg width="11" height="11" viewBox="0 0 11 11" fill="none"xmlns="http://www.w3.org/2000/svg">' +
                        '<path d="M5.02558 1.92456H1.89457C1.65732 1.92456 1.42978 2.0164 1.26201 2.17986C1.09425 2.34333 1 2.56504 1 2.79621V8.89779C1 9.12896 1.09425 9.35067 1.26201 9.51414C1.42978 9.6776 1.65732 9.76944 1.89457 9.76944H8.15659C8.39385 9.76944 8.62139 9.6776 8.78915 9.51414C8.95692 9.35067 9.05117 9.12896 9.05117 8.89779V5.847"' +
                        'stroke="black"' +
                        'stroke-linecap="round"' +
                        'stroke-linejoin="round"/>' +
                        '<path d="M8.38023 1.27079C8.55817 1.09741 8.79951 1 9.05116 1C9.30281 1 9.54415 1.09741 9.72209 1.27079C9.90003 1.44417 10 1.67933 10 1.92453C10 2.16973 9.90003 2.40488 9.72209 2.57827L5.47286 6.71862L3.68372 7.15445L4.131 5.41114L8.38023 1.27079Z"' +
                        'stroke="black"' +
                        'stroke-linecap="round"' +
                        'stroke-linejoin="round"/>' +
                        '</svg>' +

                        '<span >Edit</span>' +
                        ' </a>' +
                        '<a class="tbl-delete" data-id="' + data[0].items[i].id + '"  data-username="' + data[0].items[i].username + '" data-employeeid="' + data[0].items[i].employeeID +
                        '" data-fname="' + data[0].items[i].fname + '" data-lname="' + data[0].items[i].lname + '" data-email="' + data[0].items[i].email + '" data-pos="' + data[0].items[i].positionID + '"  data-gender="' + data[0].items[i].gender + '" >' +
                        '<svg width="11" height="10" viewBox="0 0 11 10" fill="none"  xmlns="http://www.w3.org/2000/svg">' +
                        '<path d="M2.56574 1C2.56574 0.734784 2.67387 0.48043 2.86634 0.292893C3.0588 0.105357 3.31985 0 3.59204 0H6.67092C6.94311 0 7.20416 0.105357 7.39663 0.292893C7.58909 0.48043 7.69722 0.734784 7.69722 1V2H9.74981C9.88591 2 10.0164 2.05268 10.1127 2.14645C10.2089 2.24021 10.263 2.36739 10.263 2.5C10.263 2.63261 10.2089 2.75979 10.1127 2.85355C10.0164 2.94732 9.88591 3 9.74981 3H9.20126L8.75636 9.071C8.73793 9.32329 8.62207 9.55941 8.43211 9.73179C8.24215 9.90417 7.99221 10 7.73263 10H2.52982C2.27024 10 2.0203 9.90417 1.83034 9.73179C1.64038 9.55941 1.52452 9.32329 1.50609 9.071L1.06222 3H0.513148C0.377053 3 0.246531 2.94732 0.150298 2.85355C0.0540636 2.75979 0 2.63261 0 2.5C0 2.36739 0.0540636 2.24021 0.150298 2.14645C0.246531 2.05268 0.377053 2 0.513148 2H2.56574V1ZM3.59204 2H6.67092V1H3.59204V2ZM2.09056 3L2.53033 9H7.73314L8.17291 3H2.09056ZM4.10518 4C4.24128 4 4.3718 4.05268 4.46803 4.14645C4.56427 4.24021 4.61833 4.36739 4.61833 4.5V7.5C4.61833 7.63261 4.56427 7.75979 4.46803 7.85355C4.3718 7.94732 4.24128 8 4.10518 8C3.96909 8 3.83857 7.94732 3.74233 7.85355C3.6461 7.75979 3.59204 7.63261 3.59204 7.5V4.5C3.59204 4.36739 3.6461 4.24021 3.74233 4.14645C3.83857 4.05268 3.96909 4 4.10518 4ZM6.15778 4C6.29387 4 6.42439 4.05268 6.52063 4.14645C6.61686 4.24021 6.67092 4.36739 6.67092 4.5V7.5C6.67092 7.63261 6.61686 7.75979 6.52063 7.85355C6.42439 7.94732 6.29387 8 6.15778 8C6.02168 8 5.89116 7.94732 5.79493 7.85355C5.69869 7.75979 5.64463 7.63261 5.64463 7.5V4.5C5.64463 4.36739 5.69869 4.24021 5.79493 4.14645C5.89116 4.05268 6.02168 4 6.15778 4Z"' +
                        'fill="black"/>' +
                        '</svg>' +
                        '<span>Delete</span></a>' +
                        '<a class="tbl-sendemail" data-id="' + data[0].items[i].id + '"  data-username="' + data[0].items[i].username + '" data-employeeid="' + data[0].items[i].employeeID +
                        '" data-fname="' + data[0].items[i].fname + '" data-lname="' + data[0].items[i].lname + '" data-sentemail="' + data[0].items[i].email + '" data-pos="' + data[0].items[i].positionID + '"  data-gender="' + data[0].items[i].gender + '"  data-emailstatus="' + data[0].items[i].status + '" >' +
                        '<svg width="11" height="10" viewBox="0 0 20 14" fill="none" xmlns="http://www.w3.org/2000/svg">' +
                        '<path d="M0 12.3047V1.19576C0 1.1829 0.0192864 1.06075 0.0578592 0.829315L6.59595 6.42237L0.0771456 12.6905C0.0257152 12.5104 0 12.3819 0 12.3047V12.3047ZM0.867888 0.0578592C0.957891 0.0192864 1.06718 0 1.19576 0H18.8042C18.92 0 19.0357 0.0192864 19.1514 0.0578592L12.594 5.6702L11.7261 6.36451L10.0096 7.77242L8.29315 6.36451L7.42526 5.6702L0.867888 0.0578592ZM0.887174 13.4426L7.46384 7.13597L10.0096 9.19961L12.5554 7.13597L19.1321 13.4426C19.0293 13.4812 18.92 13.5005 18.8042 13.5005H1.19576C1.0929 13.5005 0.990035 13.4812 0.887174 13.4426V13.4426ZM13.4233 6.42237L19.9421 0.829315C19.9807 0.945034 20 1.06718 20 1.19576V12.3047C20 12.4204 19.9807 12.549 19.9421 12.6905L13.4233 6.42237Z" fill="black"/>' +
                        '</svg>' +
                        '<span>Send Email</span></a>' +
                        '</div></div>' + '</td>' +
                        '<td>' + data[0].items[i].username + '</td>' +
                        '<td>' + data[0].items[i].email + '</td>' +
                        '<td>' + data[0].items[i].gender + '</td>' +
                        '<td>' + data[0].items[i].corporatename + '</td>' +
                        '<td>' + data[0].items[i].position + '</td>' +
                        '<td>' + data[0].items[i].status + '</td>' +
                        '<td><p>' + data[0].items[i].dateCreated + '</p> </td>',
                        +'</tr>']);
                }
            
          
                $.unblockUI();

            }).fail(function () {
                alert("There was an Error When Loading Data...");
            });
        }





@* User Register Send Email *@
                    $('#corpuserregister-table').on('click', '.tbl-sendemail', function () {
                    
                       var data = {};
                        data.fname = $(this).data("fname");
                        data.lname = $(this).data("lname");
                        data.email = $(this).data("sentemail");
     
                       var id=  $(this).data("id");
                        console.log(id);
                       if($(this).data("emailstatus") =="REGISTERED")
                       {
                          notifyMsg('Warning!', 'User Already Verified.', 'yellow', 'fas fa-exclamation-triangle');
                       }
                       else
                       {
                          iziToast.question({
                          timeout: 20000,
                          close: false,
                          overlay: true,
                          id: 'question',
                          zindex: 999,
                          title: 'Confirmation',
                          message: 'Are you sure you want to Send Email?',
                          position: 'center',
                          buttons: [
                          
                              ['<button><b>YES</b></button>', function (instance, toast) {
                                  $.blockUI(reloadLoading);
                                  $.ajax({

                                    
                                       url: '/Register/UpdateUserStatus',
                                    data: {
                                        data:id
                                      },
                                      type: "POST",
                                      datatype: "json"
                                  }).done(function (response) {
                                    $.ajax({
                                        type: "POST",
                                        url: '/Register/SendemailUser',
                                        data: {
                                            data: data
                                        },
                                        dataType: 'json',
                                        success: function (response) {
                                          console.log(response);
                                      

                                        }
                                    });
                                      notifyMsg('Success!', 'Email Successfully Sent!', 'green', 'fas fa-check');
                                      
                                    ShowCorporateAdminList();
                                  $(".alert-warning").hide();

                                      $.unblockUI();

                                  }).fail(function () {
                                      alert("There was an Error When Loading Data...");
                                  });
                                  instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                              }, true],
                              ['<button>NO</button>', function (instance, toast) {

                                  instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                              }],
                          ]
                      });
                       }
                         

                    });
@* User Register Send Email End Here *@

@* User register edit *@
                    $('#corpuserregister-table').on('click', '.tbl-edit', function () {
                      i_id = $(this).data("id");
                      uname = $(this).data("username");
                      empid = $(this).data("employeeid");
                      fname = $(this).data("fname");
                      lname = $(this).data("lname");
                      email = $(this).data("email");
                      gender = $(this).data("gender");
                      positionID = $(this).data("pos");
                      displayimg = $(this).data("displayimg");
                      isVIP = $(this).data("vipstats");
                      console.log(i_id);
                      if (displayimg != null) {
                      var img = $('<img>').attr('src', displayimg);
                      img.attr('height', '120px');
                      img.attr('width', '120px');
                      $('.upload-image-preview').html(img);
                      } 
                      else {
                          document.getElementById("upload-image-preview").innerHTML = '<i class="fas fa-user-tie fa-5x" style="  margin-left: 25px;"></i><br>Photo Preview</div>';
                      }
                      $("#user").val(uname);
                      $("#empid").val(empid);
                      $("#fname").val(fname);
                      $("#lname").val(lname);
                      $("#email").val(email);
                        $("#gender").val(gender);
                        $('#vip-option').val(isVIP);
                      $("#corpadminuser-position").val(positionID);
                        var data = {};
                        data.Id = $('#user-corporate-option').val();
                         
                        
                        $.ajax({
                            url: '/Register/CorporateFilterMembership',
                            data: {
                                data: data,
                            },
                            type: "POST",
                            datatype: "json",
                            success: function (response) {
                            console.log(response);
                            $('#mem-option').val(response.stats);
                          }
                        });
                      document.getElementById("btn-register").innerHTML = 'Update';
                      $('#registermodal').modal('show');
                      $(".alert-warning").hide();

                    });
@* User Register Edit End Here*@



@* User Register Delete *@
                    $('#corpuserregister-table').on('click', '.tbl-delete', function () {
                      var data = {};
                      data.id = $(this).data("id");
                      data.employeeID = $(this).data("employeeid");
                      data.Fname = $(this).data("fname");
                      data.Lname = $(this).data("lname");
                      data.Username = $(this).data("username");
                      data.password = "n/a";
                      data.gender = $(this).data("gender");
                      data.Email = $(this).data("email");
                      data.positionID = $(this).data("pos");
                      data.CorporateID = @Accessor.HttpContext.Session.GetString("CorporateID");
                      data.Active = "6";
                      data.Type = "3";
                        
                      iziToast.question({
                          timeout: 20000,
                          close: false,
                          overlay: true,
                          id: 'question',
                          zindex: 999,
                          title: 'Confirmation',
                          message: 'Are you sure you want to delete?',
                          position: 'center',
                          buttons: [
                              ['<button><b>YES</b></button>', function (instance, toast) {
                                  $.blockUI(reloadLoading);
                                  $.ajax({
                                       url: '/Register/DeleteUserInfo',
                                    data: {
                                           data: data,
                                      },
                                      type: "POST",
                                      datatype: "json"
                                  }).done(function (data) {

                                      notifyMsg('Success!', 'Successfully Deleted!', 'green', 'fas fa-check');
                                            var type = "Tax";
                                       ShowCorporateAdminList();

                                      $.unblockUI();

                                  }).fail(function () {
                                      alert("There was an Error When Loading Data...");
                                  });
                                  instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                              }, true],
                              ['<button>NO</button>', function (instance, toast) {

                                  instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                              }],
                          ]
                      });


                    });
@* User Register End Here*@


@* Function Clear *@
                    function clear()
                    {
                      $('input[type="text"]').val("");
                      $('input[type="email"]').val("");
                      $('input[type="password"]').val("");
                      $('#corpadminuser-position').prop('selectedIndex', 0);
                      $('#gender').prop('selectedIndex', 0);
                      $('#usertype-options').prop('selectedIndex', 0);
                      $('#vip-option').prop('selectedIndex', 0);
                      $('#mem-option').prop('selectedIndex', 0);
                    }
@* Clear End Here*@

@* User Register Add new User *@
                    $('#add-newuser').click(function () {
                      i_id = 0;
                      var img = $('<img>').attr('src', "https://www.alfardanoysterprivilegeclub.com/assets/img/defaultavatar.png");
                      img.attr('height', '120px');
                      img.attr('width', '120px');
                      $('.upload-image-preview').html(img);
                      $(".upload-image-preview").attr("src", );
                      $('input[type="text"]').val("");
                      $('input[type="email"]').val("");
                      $('input[type="password"]').val("");
                      $('#corpadminuser-position').prop('selectedIndex', 0);
                      $('#gender').prop('selectedIndex', 0);
                      $('#registermodal').modal('show');

                    });
@* User Register Add new User End Here*@



@* User Download Here *@
                    $('#btn-download-user').click(function () {
                      location.replace('../Register/DownloadHeader');
                    });
@* User Download Here *@

@* User Register Add Function *@
                    $('#btn-register').click(function () {

                    var filename = $("#img").val().replace(/.*(\/|\\)/, '');
                    var data = {};
                     console.log(filename);
                    if(filename =="" || filename == null)
                    {
                      filename = img_edit;
                    }
                    data.id = i_id;
                    data.EmployeeID = $('#empid').val();
                    data.Fname = $('#fname').val();
                    data.Lname = $('#lname').val();
                    data.Username = $('#user').val();
                    data.gender = $('#gender').val();
                    data.Email = $('#email').val();
                    data.positionID = $('#corpadminuser-position').val();
                    data.CorporateID =  @Accessor.HttpContext.Session.GetString("CorporateID");
                    data.Active = "2";
                    data.Type=  3;
                    data.FilePath=filename;
                        data.isVIP = $('#vip-option').val();
                    let valid = true;
                     
                    
                      var fileUpload = $("#img").get(0);
                      var files = fileUpload.files;
                      var formData = new FormData();
                      formData.append('file', files[0]);
                        var fileUpload = $("#upload-img").get(0);

         
                      console.log(formData);
                    if ($('#empid').val() == '' || $('#fname').val() == '' ||  $('#lname').val() == '' || $('#email').val() == '' ||  $('#gender').prop('selectedIndex') == 0  ||    $('#corpadminuser-position').prop('selectedIndex') == 0  ||  $('#vip-option').prop('selectedIndex') == 0  ) 
                    {
                        notifyMsg('Warning!', 'Please fill up all required fields.', 'yellow', 'fas fa-exclamation-triangle');
                           $("#vip-option").focus();
                    }
                    else

                    {
                         if (files.length > 0) {
                          if (files[0].size > 500000) {
                              notifyMsg('Warning!', 'Uploaded image reached the maximum file size. Image size should be maximum of 500 KB.', 'yellow', 'fas fa-exclamation-triangle');
                              return false;
                          }
                            }
                            iziToast.question({
                            timeout: 20000,
                            close: false,
                            overlay: true,
                            id: 'question',
                            zindex: 999,
                            title: 'Confirmation',
                            message: 'Are you sure you want to Add new User?',
                            position: 'center',
                            buttons: [
                                ['<button><b>YES</b></button>', function (instance, toast) {
                                    $.blockUI(reloadLoading);
                                    $.ajax({
                                        url: '/Register/SaveUserInfo',
                                        data: {
                                            data: data
                                        },
                                        type: "POST",
                                        datatype: "json",
                                    }).done(function (response) {
                                        if(response.stats == "Error in Registration")
                                        {
                                          notifyMsg('Warning!', response.stats, 'yellow', 'fas fa-exclamation-triangle');
                                          $("#empid").focus();
                                        }
                                        else
                                        {
                                           $.ajax({
                                            url: '/Register/UploadFile',
                                            type: 'POST',
                                            data: formData,
                                            processData: false,
                                            contentType: false,
                                            success: function (result) {
                                            }
                                            });
                                            notifyMsg('Success!', response.stats, 'green', 'fas fa-check');
                                          ShowCorporateAdminList();
                                            clear();
                                            $("#h-close").click();
                                            $('#registermodal').modal('hide');
                                       
                                        } 
                                     
                                        $.unblockUI();

                                    }).fail(function () {
                                        alert("There was an Error When Loading Data...");
                                    });
                                    instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                                }, true],
                                ['<button>NO</button>', function (instance, toast) {

                                    instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                                }],
                            ]
                        });
                    }   
                    });
@* User Register Add Function End Here*@

                    $('#add-position').click(function () {
                        i_id = 0;
                        $('input[type="text"]').val("");
                        $('#positionmodal').modal('show');

                    });
                $('#pos-table').on('click', '.tbl-edit', function () {
                    i_id = $(this).data("id");
                    $("#posname ").val($(this).data("posname"));
                    $("#desc").val($(this).data("description"));
                    document.getElementById("btn-save").value = 'Update';
                    $('#positionmodal').modal('show');
                });
                $('#submitpos').submit(function (e) {
                    e.preventDefault();

                    var data = {};
                    data.id = i_id;
                    data.PositionName = $("#posname").val();
                    data.Description = $("#desc").val();

                    iziToast.question({
                        timeout: 20000,
                        close: false,
                        overlay: true,
                        id: 'question',
                        zindex: 999,
                        title: 'Confirmation',
                        message: 'Are you sure you want to Add new User?',
                        position: 'center',
                        buttons: [
                            ['<button><b>YES</b></button>', function (instance, toast) {
                                $.blockUI(reloadLoading);
                                $.ajax({
                                    url: '/Register/SavePosition',
                                    data: {
                                        data: data,
                                    },
                                    type: "POST",
                                    datatype: "json",
                                }).done(function (response) {
                                    console.log(response.stats);
                                    if (response.stats == "Inserted Successfully" || response.stats == "Updated Successfully") {

                                        notifyMsg('Success!', response.stats, 'green', 'fas fa-check');
                                        $("#h-close").click();
                                        ShowPositionList();
                                    }
                                    else {
                                        notifyMsg('Warning!', response.stats, 'red', 'fas fa-exclamation-triangle');
                                    }

                                    $.unblockUI();

                                }).fail(function () {
                                    alert("There was an Error When Loading Data...");
                                });
                                instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                            }, true],
                            ['<button>NO</button>', function (instance, toast) {

                                instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                            }],
                        ]
                    });


                });
                $('#pos-table').on('click', '.tbl-delete', function () {
                    var data = {};
                    data.id = $(this).data("id");

                    iziToast.question({
                        timeout: 20000,
                        close: false,
                        overlay: true,
                        id: 'question',
                        zindex: 999,
                        title: 'Confirmation',
                        message: 'Are you sure you want to delete?',
                        position: 'center',
                        buttons: [
                            ['<button><b>YES</b></button>', function (instance, toast) {
                                $.blockUI(reloadLoading);
                                $.ajax({
                                    url: '/Register/DeletePositionInfo',
                                    data: {
                                        data: data,
                                    },
                                    type: "POST",
                                    datatype: "json"
                                }).done(function (data) {

                                    console.log(data.stats);
                                    if (data.stats == "Succesfully deleted") {
                                        notifyMsg('Success!', data.stats, 'green', 'fas fa-check');
                                        $("#h-close").click();
                                        ShowPositionList();
                                    }
                                    else {
                                        notifyMsg('Warning!', data.stats, 'red', 'fas fa-exclamation-triangle');
                                    }

                                    $.unblockUI();

                                }).fail(function () {
                                    alert("There was an Error When Loading Data...");
                                });
                                instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                            }, true],
                            ['<button>NO</button>', function (instance, toast) {

                                instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                            }],
                        ]
                    });


                });
</script>
}