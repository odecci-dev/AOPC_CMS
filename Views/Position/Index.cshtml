@{
    ViewData["Title"] = "Position Maintenance";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string message = "";
    if (ViewData["Message"] != null)
    {
        message = ViewData["Message"].ToString();
    }
}
@* New DataTables Start*@
<link rel="stylesheet" href="/css/datatable.css" />
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdn.datatables.net/2.1.8/js/dataTables.js"></script>
@* New DataTables End*@
<div class="register-main-container">
     <div class="btype-data">
        <div class="list-title">
            <h4 style="font-size: 26px;" class="text-left"
                    style="
                    display: flex;
                    justify-content: start;
                    align-items: center;
                    gap: 10px;
                    font-size: 26px;
                ">
                <svg xmlns="http://www.w3.org/2000/svg" height="26px" viewBox="0 -960 960 960" width="26px" fill="var(--light)">
                    <path d="M42-120v-112q0-33 17-62t47-44q51-26 115-44t141-18q77 0 141 18t115 44q30 15 47 44t17 62v112H42Zm80-80h480v-32q0-11-5.5-20T582-266q-36-18-92.5-36T362-320q-71 0-127.5 18T142-266q-9 5-14.5 14t-5.5 20v32Zm240-240q-66 0-113-47t-47-113h-10q-9 0-14.5-5.5T172-620q0-9 5.5-14.5T192-640h10q0-45 22-81t58-57v38q0 9 5.5 14.5T302-720q9 0 14.5-5.5T322-740v-54q9-3 19-4.5t21-1.5q11 0 21 1.5t19 4.5v54q0 9 5.5 14.5T422-720q9 0 14.5-5.5T442-740v-38q36 21 58 57t22 81h10q9 0 14.5 5.5T552-620q0 9-5.5 14.5T532-600h-10q0 66-47 113t-113 47Zm0-80q33 0 56.5-23.5T442-600H282q0 33 23.5 56.5T362-520Zm300 160-6-30q-6-2-11.5-4.5T634-402l-28 10-20-36 22-20v-24l-22-20 20-36 28 10q4-4 10-7t12-5l6-30h40l6 30q6 2 12 5t10 7l28-10 20 36-22 20v24l22 20-20 36-28-10q-5 5-10.5 7.5T708-390l-6 30h-40Zm20-70q12 0 21-9t9-21q0-12-9-21t-21-9q-12 0-21 9t-9 21q0 12 9 21t21 9Zm72-130-8-42q-9-3-16.5-7.5T716-620l-42 14-28-48 34-30q-2-5-2-8v-16q0-3 2-8l-34-30 28-48 42 14q6-6 13.5-10.5T746-798l8-42h56l8 42q9 3 16.5 7.5T848-780l42-14 28 48-34 30q2 5 2 8v16q0 3-2 8l34 30-28 48-42-14q-6 6-13.5 10.5T818-602l-8 42h-56Zm28-90q21 0 35.5-14.5T832-700q0-21-14.5-35.5T782-750q-21 0-35.5 14.5T732-700q0 21 14.5 35.5T782-650ZM362-200Z"/>
                </svg>
                @* <i class="fas fa-user-tie"></i>  *@
                @ViewData["Title"].ToString()
            </h4>
        </div>
                <div class="card-body ">
                    <div class="row">

                        <div class="col-lg-12">

                            <div class="row ">
                                <div id="register-table_wrapper" class="dataTables_wrapper no-footer" style="width:100%;overflow-x:auto;">
                                    <table id="pos-table" class="myTableMedium">
                                             <thead>
                                            <th>
                                               <button class="register"  
                                                       style ="
                                                            margin-bottom: 5px;
                                                            font-size: 13px;
                                                            width: 100px; 
                                                            padding: 5px 15px 5px 5px;
                                                            height: 25px;
                                                            font-size: clamp(0.5rem, 2vw, 0.7rem);
                                                            display:flex;
                                                            gap: 5px;
                                                            align-items: center" 
                                                       title="Add New Position" id="add-position">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="12px" viewBox="0 -960 960 960" width="12px" fill="var(--light)"><path d="M720-400v-120H600v-80h120v-120h80v120h120v80H800v120h-80Zm-360-80q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47ZM40-160v-112q0-34 17.5-62.5T104-378q62-31 126-46.5T360-440q66 0 130 15.5T616-378q29 15 46.5 43.5T680-272v112H40Z" /></svg>
                                                        @* <i class="fas fa-user-plus"></i> *@
                                                        Add New
                                                    </button>
                                            </th>
                                            <th>Description</th>
                                            <th>Date Created</th>
                                        </thead>
                                        <tbody style="height: 150px;">

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

               
                    </div>
                </div>
                </div>
            </div>
<div class="modal fade" id="positionmodal" tabindex="-1" role="dialog" aria-labelledby="modal-title"
        aria-hidden="true" style="display: none;" data-keyboard="false" data-backdrop="static" >

        <div class="modal-dialog modal-error-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="modal-name">Position Details Form</h4>
                    <button type="button" id="h-close" class="close" data-dismiss="modal" aria-hidden="false">x</button>
                </div>
                <div class="col-lg-12" style="margin:10px">

                    <form action="" class="mod-form" id="submitpos">
          
          <div class="mod-form-row">
            <div class="input-container-whole">
              <label for="employeeID">Position Name<span class="req" >*</span></label>
              <input type="text" value="" id="posname" class="mod-input" required />
            </div>
         
          </div>
          <div class="mod-form-row">
               <div class="input-container-whole">
              <label for="email">Position Description</label>
              <input type="text" value="" id="desc" class="mod-input" />
            </div>
          </div>
       
          
          <div class="actions" style="align-items: center;">
            <div class="actionss">
             @* <button class="register" type="button" style ="margin-bottom: 5px;font-size: 13px;    padding: 5px 15px 5px 5px;height: 25px;font-size: clamp(0.5rem, 2vw, 0.7rem);" title="Add New" id="add Mechanics"><i class="fas fa-id-card"></i>Add Mechanics</button> *@
             @* <input type="button" value="Add Mechanics" id="btn-register"/> <i class="fas fa-cogs"></i> *@

            </div>

            <a  data-dismiss="modal" aria-hidden="false" style="cursor:pointer" class="cancel"><u>Cancel</u></a>
            <input type="submit" value="Submit" id="btn-save"/>
          </div>
        </form>


                </div>
            </div>
        </div>

    </div>
@section Scripts{
<script>
 $(document).ready(function () {
  // postable = $('#pos-table').DataTable({
  //                    "columnDefs": [

  //                       { "width": "80px", "targets": 0 },
  //                       { "width": "150px", "targets": 1 },
  //                       {  "width": "70px", "targets": 2 }
  //                     ],
  //                   order: [[ 2, "desc" ]],
  //                   "bPaginate": false,
  //                   "bFilter": false,
  //                   "stripeClasses": [],
  //                   "ordering": false,
  //                   "info": false,
  //                   "bInfo": false,
  //                   "bAutoWidth": false,
  //                   "bLengthChange": false, 
  //                    "paging": true,
  //                     "aLengthMenu": [10],
  //                     "searching": true,
  //                   "oLanguage": { "sZeroRecords": "", "sEmptyTable": "",
                    
  //               }});
ShowPositionList();
 });


$('#add-position').click(function () {
            i_id = 0;
            $('input[type="text"]').val("");
            $('#positionmodal').modal('show');

           });
$('#pos-table').on('click', '.tbl-edit', function () {
            i_id = $(this).data("id");
             $("#posname ").val($(this).data("posname"));
             $("#desc").val($(this).data("description"));
             $('#positionmodal').modal('show');
   });
$('#submitpos').submit(function(e){
       e.preventDefault();
       
       var data={};
       data.id=i_id;
      data.PositionName = $("#posname").val();
      data.Description = $("#desc").val();
            if (i_id != 0) {
                message = 'Are you sure you want to update this ' + $("#posname").val() +' ?';
            }
            else {
                message = 'Are you sure you want to Add new position?';
            }
                        iziToast.question({
                            timeout: 20000,
                            close: false,
                            overlay: true,
                            id: 'question',
                            zindex: 999,
                            title: 'Confirmation',
                            message: message,
                            position: 'center',
                            buttons: [
                                ['<button><b>YES</b></button>', function (instance, toast) {
                                    $.blockUI(reloadLoading);
                                    $.ajax({
                                        url: '/Register/SavePosition',
                                        data: {
                                            data: data,
                                        },
                                        type: "POST",
                                        datatype: "json",
                                    }).done(function (response) {
                                      // console.log(response.stats);
                                      if(response.stats=="Inserted Successfully" || response.stats=="Updated Successfully")
                                      {
                                          
                                          notifyMsg('Success!', response.stats, 'green', 'fas fa-check');
                                          $("#h-close").click();
                                          ShowPositionList();
                                      }
                                      else
                                      {
                                         notifyMsg('Warning!', response.stats, 'red', 'fas fa-exclamation-triangle');
                                      }
                                            
                                         $.unblockUI();

                                    }).fail(function () {
                                        alert("There was an Error When Loading Data...");
                                    });
                                    instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                                }, true],
                                ['<button>NO</button>', function (instance, toast) {

                                    instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                                }],
                            ]
                        });
       
                          
      });
 $('#pos-table').on('click', '.tbl-delete', function () {
                      var data = {};
                      data.id = $(this).data("id");
                        
                      iziToast.question({
                          timeout: 20000,
                          close: false,
                          overlay: true,
                          id: 'question',
                          zindex: 999,
                          title: 'Confirmation',
                          message: 'Are you sure you want to delete?',
                          position: 'center',
                          buttons: [
                              ['<button><b>YES</b></button>', function (instance, toast) {
                                  $.blockUI(reloadLoading);
                                  $.ajax({
                                       url: '/Register/DeletePositionInfo',
                                    data: {
                                           data: data,
                                      },
                                      type: "POST",
                                      datatype: "json"
                                  }).done(function (data) {
                                    
                                      // console.log(data.stats);
                                      if(data.stats=="Succesfully deleted" )
                                      {
                                          notifyMsg('Success!', data.stats, 'green', 'fas fa-check');
                                          $("#h-close").click();
                                          ShowPositionList();
                                      }
                                      else
                                      {
                                         notifyMsg('Warning!', data.stats, 'red', 'fas fa-exclamation-triangle');
                                      }
                                  
                                      $.unblockUI();

                                  }).fail(function () {
                                      alert("There was an Error When Loading Data...");
                                  });
                                  instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                              }, true],
                              ['<button>NO</button>', function (instance, toast) {

                                  instance.hide({ transitionOut: 'fadeOut' }, toast, 'button');

                              }],
                          ]
                      });


                    });

</script>
}